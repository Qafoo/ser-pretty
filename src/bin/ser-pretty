#!/usr/bin/env php
<?php

namespace Qafoo\SerPretty;

function includeIfExists($file)
{
    if (file_exists($file)) {
        return include $file;
    }
}

if ((!$loader = includeIfExists(__DIR__.'/../../vendor/autoload.php')) && (!$loader = includeIfExists(__DIR__.'/../../../../autoload.php'))) {
    $msg = 'You must set up the project dependencies, run the following commands:'.PHP_EOL.
           'curl -sS https://getcomposer.org/installer | php'.PHP_EOL.
           'php composer.phar install'.PHP_EOL;
    fwrite(STDERR, $msg);
    exit(1);
}

$parser = new Parser(true);
$writer = new Writer\SimpleTextWriter();

if (!empty($_SERVER['argv'][1])) {
    $contents = file_get_contents($_SERVER['argv'][1]);
} else {
    $contents = file_get_contents('php://stdin');
}

$node = $parser->parse($contents);
echo $writer->write($node) . "\n";
